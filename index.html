<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wasteland Drifter v11 (Expedition)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        :root {
            --bg: #050505; --card: #141414; --border: #333;
            --primary: #00e676; --danger: #ff5252; --warn: #ffab00; --rare: #d500f9;
            --text: #e0e0e0; --dim: #757575;
            --font: 'Roboto Mono', monospace;
        }

        body {
            background-color: var(--bg); color: var(--text); font-family: var(--font);
            margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- LAYOUT --- */
        .header {
            padding: 10px 15px; background: #111; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; z-index: 10;
        }
        .mode-badge {
            font-size: 10px; padding: 4px 8px; border-radius: 4px; font-weight: bold; text-transform: uppercase;
        }
        .mode-safe { background: #003300; color: var(--primary); border: 1px solid var(--primary); }
        .mode-danger { background: #330000; color: var(--danger); border: 1px solid var(--danger); animation: pulse 2s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .main-view { flex-grow: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; display: none; flex-direction: column; gap: 15px; }
        .main-view.active { display: flex; }

        /* --- CARDS --- */
        .card {
            background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 15px;
            position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .card h3 { margin: 0 0 10px 0; color: var(--primary); font-size: 16px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        /* --- LOGS --- */
        .log-box {
            height: 200px; overflow-y: auto; background: #000; border: 1px solid #333; padding: 10px;
            display: flex; flex-direction: column-reverse; gap: 8px; border-radius: 4px;
        }
        .msg { font-size: 12px; border-left: 2px solid #555; padding-left: 8px; }
        .msg.good { border-color: var(--primary); color: #ccffcc; }
        .msg.bad { border-color: var(--danger); color: #ffcccc; }
        .msg.rare { border-color: var(--rare); color: #ffccff; }

        /* --- BUTTONS --- */
        button {
            background: var(--card); border: 1px solid var(--border); color: var(--text);
            padding: 12px; border-radius: 4px; font-family: inherit; font-weight: bold;
            cursor: pointer; width: 100%; text-transform: uppercase; font-size: 12px; transition: 0.2s;
        }
        button:active { transform: scale(0.98); }
        button.primary { background: var(--primary); color: #000; border: none; }
        button.danger { background: var(--danger); color: #fff; border: none; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* --- INVENTORY GRID --- */
        .inv-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 10px; }
        .inv-slot {
            aspect-ratio: 1; background: #222; border: 1px solid #444; border-radius: 4px;
            display: flex; justify-content: center; align-items: center; font-size: 20px;
            position: relative; cursor: pointer;
        }
        .inv-slot.filled { border-color: var(--dim); }
        .inv-qty { position: absolute; bottom: 1px; right: 2px; font-size: 10px; color: #fff; }

        /* --- MUSEUM --- */
        .artifact-row { 
            display: flex; justify-content: space-between; padding: 8px; background: #1a1a1a; 
            margin-bottom: 5px; border-left: 2px solid var(--rare); font-size: 12px;
        }

        /* --- NAV --- */
        .nav-deck {
            position: fixed; bottom: 0; width: 100%; background: #080808; border-top: 1px solid #333;
            display: grid; grid-template-columns: 1fr 1fr 1fr; height: 60px; z-index: 20;
        }
        .nav-btn { background: none; border: none; color: #555; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; gap: 4px; }
        .nav-btn span { font-size: 18px; }
        .nav-btn.active { color: var(--primary); }

        /* --- LOADING OVERLAY --- */
        #death-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(50,0,0,0.9); z-index: 99; display: none;
            flex-direction: column; justify-content: center; align-items: center;
        }

    </style>
</head>
<body>

    <div class="header">
        <div id="mode-badge" class="mode-badge mode-safe">BUNKER (SAFE)</div>
        <div style="font-size: 12px;">SCRAP: <span id="scrap-display" style="color:#fff;">0</span></div>
    </div>

    <div id="view-bunker" class="main-view active">
        <div class="card">
            <h3>PLAN EXPEDITION</h3>
            <p>Prepare your backpack. If you die in the wasteland, you lose what you carry.</p>
            <div style="background:#222; padding:10px; border-radius:4px; margin-bottom:10px;">
                <div style="font-size:10px; color:#aaa; margin-bottom:5px;">BACKPACK (Max 5 Slots)</div>
                <div id="prep-grid" class="inv-grid"></div>
            </div>
            <div class="grid-2">
                <button onclick="addToPack('food')">+ FOOD (<span id="stash-food">0</span>)</button>
                <button onclick="addToPack('meds')">+ MEDS (<span id="stash-meds">0</span>)</button>
            </div>
            <button class="primary" style="margin-top:10px;" onclick="startExpedition()">LEAVE BUNKER</button>
        </div>

        <div class="card">
            <h3>üì¶ STASH</h3>
            <div style="font-size:12px; display:flex; justify-content:space-between;">
                <span>Total Food: <span id="total-food">0</span></span>
                <span>Total Meds: <span id="total-meds">0</span></span>
            </div>
        </div>
    </div>

    <div id="view-expedition" class="main-view">
        <div class="card" style="border-color:var(--danger);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="color:var(--danger); border:none;">MILE <span id="mile-display">1</span></h3>
                <div style="font-size:12px;">HP: <span id="hp-display">100</span>%</div>
            </div>
            <div class="stat-bar" style="height:4px; background:#333; margin-top:5px;"><div id="hp-bar" style="height:100%; width:100%; background:var(--danger);"></div></div>
        </div>

        <div id="exp-log" class="log-box"></div>

        <div class="card">
            <div class="grid-2">
                <button onclick="useItem('food')">EAT (Food: <span id="pack-food">0</span>)</button>
                <button onclick="useItem('meds')">HEAL (Meds: <span id="pack-meds">0</span>)</button>
            </div>
            <div style="margin-top:10px; font-size:10px; color:#aaa; text-align:center;">LOOT COLLECTED</div>
            <div id="loot-display" style="text-align:center; color:#fff; font-weight:bold; margin-bottom:10px;">None</div>

            <button class="primary" id="btn-continue" onclick="nextMile()">PUSH DEEPER (Risk ++)</button>
            <button class="danger" onclick="endExpedition()">RETURN HOME (Secure Loot)</button>
        </div>
    </div>

    <div id="view-museum" class="main-view">
        <div class="card">
            <h3>üèõÔ∏è ARTIFACT COLLECTION</h3>
            <p>Rare items found in the wasteland provide passive bonuses.</p>
            <div id="museum-list"></div>
        </div>
    </div>

    <div class="nav-deck" id="nav-bar">
        <button class="nav-btn active" onclick="switchView('bunker')"><span>üè†</span>BUNKER</button>
        <button class="nav-btn" onclick="switchView('museum')"><span>üèõÔ∏è</span>MUSEUM</button>
        <button class="nav-btn" onclick="resetData()"><span>üíÄ</span>RESET</button>
    </div>

    <div id="death-screen">
        <h1 style="color:var(--danger);">YOU DIED</h1>
        <p style="color:#aaa;">Your backpack was lost in the wastes.</p>
        <button style="width:200px;" onclick="respawn()">WAKE UP IN BUNKER</button>
    </div>

    <script>
        // --- GAME DATA ---
        const ARTIFACTS = [
            { id: 'coin', name: 'Old Coin', desc: '+10% Scrap Find', icon: 'ü™ô' },
            { id: 'compass', name: 'Gold Compass', desc: 'Lower Risk at high miles', icon: 'üß≠' },
            { id: 'comic', name: 'Grognak Comic', desc: '+5 Max HP', icon: 'üìñ' },
            { id: 'tape', name: 'Data Holotape', desc: 'Unlock Lore', icon: 'üìº' }
        ];

        // --- STATE ---
        let state = {
            stash: { food: 5, meds: 2, scrap: 0 },
            collection: [], // Artifact IDs
            maxHp: 100
        };

        // Volatile State (Reset on death/return)
        let run = {
            active: false,
            hp: 100,
            mile: 0,
            backpack: { food: 0, meds: 0 }, // Items brought
            loot: { scrap: 0, artifacts: [] }, // Items found
            log: []
        };

        // --- INIT ---
        window.onload = () => {
            if(localStorage.getItem('wd_v11_save')) {
                state = JSON.parse(localStorage.getItem('wd_v11_save'));
            }
            updateUI();
        };

        // --- EXPEDITION LOGIC ---
        function addToPack(item) {
            let totalPack = run.backpack.food + run.backpack.meds;
            if(totalPack >= 5) return alert("Backpack full! (Max 5 items)");
            
            if(state.stash[item] > 0) {
                state.stash[item]--;
                run.backpack[item]++;
                updateUI();
            }
        }

        function startExpedition() {
            run.active = true;
            run.hp = state.maxHp;
            run.mile = 0;
            run.loot = { scrap: 0, artifacts: [] };
            run.log = ["Left the bunker..."];
            
            // Switch UI
            document.getElementById('nav-bar').style.display = 'none';
            document.getElementById('view-bunker').classList.remove('active');
            document.getElementById('view-expedition').classList.add('active');
            updateRunUI();
            
            // Auto-start Mile 1
            nextMile();
        }

        function nextMile() {
            run.mile++;
            let risk = run.mile * 10; // Risk increases 10% per mile
            
            // Artifact Bonus
            if(hasArtifact('compass')) risk -= 10; 

            let roll = Math.random() * 100;
            let msg = "";
            let type = "";

            if(roll < risk) {
                // BAD EVENT
                let dmg = Math.floor(Math.random() * 10) + (run.mile * 2);
                run.hp -= dmg;
                msg = `Mile ${run.mile}: Ambushed! Took ${dmg} damage.`;
                type = "bad";
            } else {
                // GOOD EVENT
                let scrapFind = Math.floor(Math.random() * 5) + (run.mile * 2);
                // Artifact Bonus
                if(hasArtifact('coin')) scrapFind = Math.floor(scrapFind * 1.1);
                
                run.loot.scrap += scrapFind;
                msg = `Mile ${run.mile}: Found ${scrapFind} Scrap.`;
                type = "good";

                // Rare Artifact Chance (Higher at deeper miles)
                if(Math.random() < (run.mile * 0.05)) {
                    let art = ARTIFACTS[Math.floor(Math.random() * ARTIFACTS.length)];
                    if(!state.collection.includes(art.id) && !run.loot.artifacts.includes(art.id)) {
                        run.loot.artifacts.push(art.id);
                        msg = `!!! FOUND ARTIFACT: ${art.name} !!!`;
                        type = "rare";
                    }
                }
            }

            logRun(msg, type);
            updateRunUI();

            if(run.hp <= 0) die();
        }

        function useItem(item) {
            if(run.backpack[item] > 0) {
                run.backpack[item]--;
                if(item === 'food') run.hp = Math.min(run.hp + 15, state.maxHp);
                if(item === 'meds') run.hp = Math.min(run.hp + 40, state.maxHp);
                logRun(`Used ${item}.`, "good");
                updateRunUI();
            }
        }

        function endExpedition() {
            // Secure Loot
            state.stash.scrap += run.loot.scrap;
            
            // Unpack Leftovers
            state.stash.food += run.backpack.food;
            state.stash.meds += run.backpack.meds;

            // Secure Artifacts
            run.loot.artifacts.forEach(id => {
                if(!state.collection.includes(id)) state.collection.push(id);
            });

            // Reset Run
            run.active = false;
            run.backpack = { food: 0, meds: 0 };
            
            // Return to Hub
            document.getElementById('nav-bar').style.display = 'grid';
            switchView('bunker');
            alert(`Returned Safely!\nSecured: ${run.loot.scrap} Scrap.`);
            saveGame();
        }

        function die() {
            document.getElementById('death-screen').style.display = 'flex';
        }

        function respawn() {
            document.getElementById('death-screen').style.display = 'none';
            run.active = false;
            run.backpack = { food: 0, meds: 0 }; // Lost forever
            document.getElementById('nav-bar').style.display = 'grid';
            switchView('bunker');
            saveGame();
        }

        // --- UI HELPERS ---
        function updateUI() {
            // Stash
            document.getElementById('stash-food').innerText = state.stash.food;
            document.getElementById('stash-meds').innerText = state.stash.meds;
            document.getElementById('total-food').innerText = state.stash.food;
            document.getElementById('total-meds').innerText = state.stash.meds;
            document.getElementById('scrap-display').innerText = state.stash.scrap;

            // Prep Grid
            let grid = document.getElementById('prep-grid');
            grid.innerHTML = '';
            // Render Food
            for(let i=0; i<run.backpack.food; i++) grid.innerHTML += `<div class="inv-slot filled">ü•©</div>`;
            // Render Meds
            for(let i=0; i<run.backpack.meds; i++) grid.innerHTML += `<div class="inv-slot filled">üíâ</div>`;
            // Empty Slots
            let used = run.backpack.food + run.backpack.meds;
            for(let i=0; i<(5-used); i++) grid.innerHTML += `<div class="inv-slot"></div>`;

            // Museum
            let mList = document.getElementById('museum-list');
            mList.innerHTML = '';
            if(state.collection.length === 0) mList.innerHTML = '<div style="text-align:center; color:#555; padding:20px;">No Artifacts Found Yet.<br>Explore deeper miles.</div>';
            state.collection.forEach(id => {
                let art = ARTIFACTS.find(a => a.id === id);
                mList.innerHTML += `
                    <div class="artifact-row">
                        <span>${art.icon} <b>${art.name}</b></span>
                        <span style="color:var(--primary)">${art.desc}</span>
                    </div>`;
            });

            saveGame();
        }

        function updateRunUI() {
            document.getElementById('mile-display').innerText = run.mile;
            document.getElementById('hp-display').innerText = run.hp;
            document.getElementById('hp-bar').style.width = (run.hp / state.maxHp * 100) + "%";
            
            document.getElementById('pack-food').innerText = run.backpack.food;
            document.getElementById('pack-meds').innerText = run.backpack.meds;

            let lootStr = `${run.loot.scrap} Scrap`;
            if(run.loot.artifacts.length > 0) lootStr += ` + ${run.loot.artifacts.length} Artifacts`;
            document.getElementById('loot-display').innerText = lootStr;
        }

        function logRun(msg, type) {
            let d = document.createElement('div');
            d.className = `msg ${type||''}`;
            d.innerText = msg;
            document.getElementById('exp-log').prepend(d);
        }

        function switchView(id) {
            document.querySelectorAll('.main-view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            
            let badge = document.getElementById('mode-badge');
            if(id === 'expedition') {
                badge.className = 'mode-badge mode-danger';
                badge.innerText = "WASTELAND (DANGER)";
            } else {
                badge.className = 'mode-badge mode-safe';
                badge.innerText = "BUNKER (SAFE)";
            }
            updateUI();
        }

        function hasArtifact(id) { return state.collection.includes(id); }

        function saveGame() { localStorage.setItem('wd_v11_save', JSON.stringify(state)); }
        function resetData() { localStorage.removeItem('wd_v11_save'); location.reload(); }
    </script>
</body>
</html>
